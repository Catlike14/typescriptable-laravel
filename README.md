# Typescriptable for Laravel

![Banner with printer shop picture in background and Typescriptable Laravel title](docs/banner.jpg)

[![php][php-version-src]][php-version-href]
[![laravel][laravel-src]][laravel-href]
[![version][version-src]][version-href]
[![npm][npm-version-src]][npm-version-href]
[![downloads][downloads-src]][downloads-href]
[![license][license-src]][license-href]
[![tests][tests-src]][tests-href]
[![codecov][codecov-src]][codecov-href]

PHP package for Laravel **to type Eloquent models**, **routes**, [**Spatie Settings**](https://github.com/spatie/laravel-settings) with **autogenerated TypeScript**.

If you want to use some helpers with [Inertia](https://inertiajs.com/), you can install [associated NPM package](https://www.npmjs.com/package/@kiwilan/typescriptable-laravel).

> **Note**
>
> -   [`kiwilan/typescriptable-laravel`](https://packagist.org/packages/kiwilan/typescriptable-laravel): PHP package for [Laravel](https://laravel.com/).
> -   [`@kiwilan/typescriptable-laravel`](https://www.npmjs.com/package/@kiwilan/typescriptable-laravel): optional NPM package to use with [Vite](https://vitejs.dev/) and [Inertia](https://inertiajs.com/) to have some helpers, if you want to know more about, [check documentation](https://github.com/kiwilan/typescriptable-laravel/blob/main/lib/README.md).
> -   [ziggy](https://github.com/tighten/ziggy) is **NOT REQUIRED**

|  Database  | Supported |
| :--------: | :-------: |
|   MySQL    |    ✅     |
| PostgreSQL |    ✅     |
|   SQLite   |    ✅     |
| SQL Server |    ✅     |

### Roadmap

-   [ ] 90% coverage
-   [x] Generate TS types for `morphTo`
-   [ ] Use `appends` to define type for `Casts\Attribute` methods

## Installation

> **Warning**
>
> PHP 8.1+ is required and Laravel 9+ is recommended.

You can install the package via composer:

```bash
composer require kiwilan/typescriptable-laravel
```

## Configuration

You can publish the config file

```bash
php artisan vendor:publish --tag="typescriptable-config"
```

Update config file `config/typescriptable.php`

```php
<?php

return [
    /**
     * The path to the output directory.
     */
    'output_path' => resource_path('js'),

    /**
     * Options for the models.
     */
    'models' => [
        'filename' => 'types-models.d.ts',
        /**
         * The path to the models directory.
         */
        'directory' => app_path('Models'),
        /**
         * Models to skip.
         */
        'skip' => [
            // 'App\\Models\\User',
        ],
        /**
         * Whether to add the LaravelPaginate type (with API type and view type).
         */
        'paginate' => true,
        /**
         * Whether to add the fake Jetstream Team type to avoid errors.
         */
        'fake_team' => false,
    ],
    /**
     * Options for the Spatie settings.
     */
    'settings' => [
        'filename' => 'types-settings.d.ts',
        /**
         * The path to the settings directory.
         */
        'directory' => app_path('Settings'),
        /**
         * Settings to skip.
         */
        'skip' => [
            // 'App\\Settings\\Home',
        ],
    ],
    /**
     * Options for the routes.
     */
    'routes' => [
        'filename' => 'types-routes.d.ts',
        'filename_list' => 'routes.ts',
        /**
         * Use routes `path` instead of `name` for the type name.
         */
        'use_path' => false,
        /**
         * Routes to skip.
         */
        'skip' => [
            'name' => [
                'debugbar.*',
                'horizon.*',
                'telescope.*',
                'nova.*',
                'lighthouse.*',
                'livewire.*',
                'ignition.*',
                'filament.*',
            ],
            'path' => [
                'api/*',
            ],
        ],
    ],
];
```

## Usage

```bash
php artisan typescriptable
```

-   --`A`|`all`: Generate all types.
-   --`M`|`models`: Generate Models types.
-   --`R`|`routes`: Generate Routes types.
-   --`S`|`settings`: Generate Settings types.

### Eloquent Models

Generate `resources/js/types-models.d.ts` file with all models types.

```bash
php artisan typescriptable:models
```

-   Generate TS types for [Eloquent models](https://laravel.com/docs/10.x/eloquent)
-   Generate TS types for [Eloquent relations](https://laravel.com/docs/10.x/eloquent-relationships) (except `morphTo`)
-   Generate TS types for `casts` (include native `enum` support)
-   Generate TS types for `dates`
-   Generate TS types for `appends` (partial for [`Casts\Attribute`](https://laravel.com/docs/10.x/eloquent-mutators#defining-an-accessor), you can use old way to define `get*Attribute` methods)
-   Generate TS types `counts`
-   Generate pagination TS types for [Laravel pagination](https://laravel.com/docs/10.x/pagination) with option `paginate`

### Spatie Settings

If you use [`spatie/laravel-settings`](https://github.com/spatie/laravel-settings), you can generate `resources/js/types-settings.d.ts` file with all settings types.

-   Generate TS types for Settings from PHP classes

```bash
php artisan typescriptable:settings
```

### Routes

Generate `resources/js/types-routes.d.ts` file with all routes types and `resources/js/routes.ts` for routes references.

```bash
php artisan typescriptable:routes
```

-   Generate TS types for [Laravel routes](https://laravel.com/docs/9.x/routing)
-   Generate TS types for [Laravel route parameters](https://laravel.com/docs/9.x/routing#route-parameters)
-   Generate TS types seperated by `methods`
-   Helpers to use these types are included in [`@kiwilan/typescriptable-laravel`](https://github.com/kiwilan/typescriptable-laravel/blob/main/lib/README.md) NPM package.

## Examples

### Eloquent Models

An example of Eloquent model.

```php
<?php

namespace App\Models;

use Kiwilan\Steward\Enums\PublishStatusEnum;

class Story extends Model
{
    use HasFactory;

    protected $fillable = [
        'title',
        'slug',
        'abstract',
        'original_link',
        'picture',
        'status',
        'published_at',
        'meta_title',
        'meta_description',
    ];

    protected $appends = [
        'time_to_read',
    ];

    protected $withCount = [
        'chapters',
    ];

    protected $casts = [
        'status' => PublishStatusEnum::class,
        'published_at' => 'datetime:Y-m-d',
    ];

    public function getTimeToReadAttribute(): int

    public function chapters(): HasMany

    public function category(): BelongsTo

    public function author(): BelongsTo

    public function tags(): BelongsToMany
}
```

TS file generated at `resources/js/types-models.d.ts`

```typescript
declare namespace App {
    declare namespace Models {
        export type Story = {
            id: number;
            title: string;
            slug?: string;
            abstract?: string;
            original_link?: string;
            picture?: string;
            status: "draft" | "scheduled" | "published";
            published_at?: Date;
            meta_title?: string;
            meta_description?: string;
            created_at?: Date;
            updated_at?: Date;
            author_id?: number;
            category_id?: number;
            time_to_read?: number;
            chapters?: Chapter[];
            category?: Category;
            author?: Author;
            tags?: Tag[];
            chapters_count?: number;
            tags_count?: number;
        };
    }
    // With `paginate` option.
    export type PaginateLink = {
        url: string;
        label: string;
        active: boolean;
    };
    export type Paginate<T = any> = {
        data: T[];
        current_page: number;
        first_page_url: string;
        from: number;
        last_page: number;
        last_page_url: string;
        links: App.PaginateLink[];
        next_page_url: string;
        path: string;
        per_page: number;
        prev_page_url: string;
        to: number;
        total: number;
    };
}
```

Usage in Vue component.

```vue
<script lang="ts" setup>
defineProps<{
    story?: App.Models.Story;
}>();
</script>
```

Or with paginate option.

```vue
<script lang="ts" setup>
defineProps<{
    stories?: App.Paginate<App.Models.Story>;
}>();
</script>
```

## Testing

```bash
cp .env.example .env
```

```bash
composer test
```

## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information on what has changed recently.

## Credits

-   [Ewilan Riviere](https://github.com/ewilan-riviere)

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.

[<img src="https://user-images.githubusercontent.com/48261459/201463225-0a5a084e-df15-4b11-b1d2-40fafd3555cf.svg" height="120rem" width="100%" />](https://github.com/kiwilan)

[version-src]: https://img.shields.io/packagist/v/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[version-href]: https://packagist.org/packages/kiwilan/typescriptable-laravel
[php-version-src]: https://img.shields.io/static/v1?style=flat-square&label=PHP&message=v8.1&color=777BB4&logo=php&logoColor=ffffff&labelColor=18181b
[php-version-href]: https://www.php.net/
[npm-version-src]: https://img.shields.io/npm/v/@kiwilan/typescriptable-laravel.svg?style=flat-square&color=CB3837&logoColor=ffffff&labelColor=18181b
[npm-version-href]: https://www.npmjs.com/package/@kiwilan/typescriptable-laravel
[downloads-src]: https://img.shields.io/packagist/dt/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[downloads-href]: https://packagist.org/packages/kiwilan/typescriptable-laravel
[license-src]: https://img.shields.io/github/license/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[license-href]: https://github.com/kiwilan/typescriptable-laravel/blob/main/README.md
[tests-src]: https://img.shields.io/github/actions/workflow/status/kiwilan/typescriptable-laravel/run-tests.yml?branch=main&label=tests&style=flat-square&colorA=18181B
[tests-href]: https://github.com/kiwilan/typescriptable-laravel/actions/workflows/run-tests.yml
[codecov-src]: https://codecov.io/gh/kiwilan/typescriptable-laravel/branch/main/graph/badge.svg?token=P9XIK2KV9G
[codecov-href]: https://codecov.io/gh/kiwilan/typescriptable-laravel
[laravel-src]: https://img.shields.io/static/v1?label=Laravel&message=v9&style=flat-square&colorA=18181B&colorB=FF2D20
[laravel-href]: https://laravel.com
