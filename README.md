# Typescriptable for Laravel

![Banner with printer shop picture in background and Typescriptable Laravel title](https://raw.githubusercontent.com/kiwilan/typescriptable-laravel/main/docs/banner.jpg)

[![php][php-version-src]][php-version-href]
[![version][version-src]][version-href]
[![downloads][downloads-src]][downloads-href]
[![license][license-src]][license-href]
[![codecov][codecov-src]][codecov-href]
[![tests][tests-src]][tests-href]

[![laravel][laravel-src]][laravel-href]
[![npm][npm-version-src]][npm-version-href]

PHP package for Laravel **to type Eloquent models**, **routes**, [**Spatie Settings**](https://github.com/spatie/laravel-settings) with **autogenerated TypeScript**.

If you want to use some helpers with [Inertia](https://inertiajs.com/), you can install [associated NPM package](https://github.com/kiwilan/typescriptable-laravel/blob/main/plugin/README.md).

> [!NOTE]
>
> -   [`kiwilan/typescriptable-laravel`](https://packagist.org/packages/kiwilan/typescriptable-laravel): current PHP package for [Laravel](https://laravel.com/).
> -   [`@kiwilan/typescriptable-laravel`](https://github.com/kiwilan/typescriptable-laravel/blob/main/plugin/README.md): optional NPM package to use with [Vite](https://vitejs.dev/) and [Inertia](https://inertiajs.com/) to have some helpers, if you want to know more about, [check documentation](https://github.com/kiwilan/typescriptable-laravel/blob/main/plugin/README.md).
> -   [`tightenco/ziggy`](https://github.com/tighten/ziggy) is required **only** for [`@kiwilan/typescriptable-laravel`](https://github.com/kiwilan/typescriptable-laravel/blob/main/plugin/README.md) (NPM package)

## Features

-   üíΩ All Laravel databases are supported: MySQL, PostgreSQL, SQLite, SQL Server
-   üí¨ Generate TS types for [Eloquent models](https://laravel.com/docs/10.x/eloquent)
-   üë≠ Generate TS types for [Eloquent relations](https://laravel.com/docs/10.x/eloquent-relationships)
-   ü™Ñ Generate TS types for `casts` (include native `enum` support)
-   üìÖ Generate TS types for `dates`
-   üìù Generate TS types for `appends` with [`accessors`](https://laravel.com/docs/10.x/eloquent-mutators#accessors-and-mutators)
    -   Partial for `Illuminate\Database\Eloquent\Casts\Attribute`
    -   Old way [`get*Attribute` methods](https://laravel.com/docs/8.x/eloquent-mutators#defining-an-accessor) are totally supported
-   #Ô∏è‚É£ Generate TS types for `counts`
-   üìñ Can generate pagination TS types for [Laravel pagination](https://laravel.com/docs/10.x/pagination)
-   üíæ Can generate simple PHP classes from Eloquent models
-   ‚öôÔ∏è Generate TS types for [`spatie/laravel-settings`](https://github.com/spatie/laravel-settings)
-   üõ£ Generate TS types for [Laravel routes](https://laravel.com/docs/10.x/routing)
    -   Scan route parameters
    -   For Inertia, you can install [`@kiwilan/typescriptable-laravel`](https://github.com/kiwilan/typescriptable-laravel/blob/main/plugin/README.md) NPM package to use some helpers
-   ‚úÖ Multiple commands to generate types
    -   `php artisan typescriptable` for models, settings and routes (safe even if you don't use all)
    -   `php artisan typescriptable:models` for Eloquent models
    -   `php artisan typescriptable:settings` for `spatie/laravel-settings`
    -   `php artisan typescriptable:routes` for Laravel routes

<iframe src="https://giphy.com/embed/1ffOwHDZehVb6JlRid" width="480" height="269" style="" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>

> Because you need PHP and Typescript.

### Roadmap

-   [ ] Improve `Casts\Attribute` methods
-   [ ] Add parser for [calebporzio/sushi](https://github.com/calebporzio/sushi)
-   [ ] Add parser for [spatie/laravel-permission](https://github.com/spatie/laravel-permission)
-   [ ] Add parser for [mongodb](https://github.com/mongodb/laravel-mongodb)

## Installation

This version requires [PHP](https://www.php.net/) `8.2+` and supports [Laravel](https://laravel.com/) 11.

> [!WARNING]
>
> Laravel 11 dropped [Doctrine DBAL](https://laravel.com/docs/11.x/upgrade#doctrine-dbal-removal). For previous Laravel versions, you can use `1.12.03` version.

| Version                                                                          | L9                 | L10                | L11                |
| -------------------------------------------------------------------------------- | ------------------ | ------------------ | ------------------ |
| [1.12.03](https://packagist.org/packages/kiwilan/typescriptable-laravel#1.12.03) | :white_check_mark: | :white_check_mark: | :x:                |
| [2.0.0](https://packagist.org/packages/kiwilan/typescriptable-laravel#2.0.0)     | :x:                | :x:                | :white_check_mark: |

You can install the package via composer:

With **Laravel v11+** and PHP `8.2`

```bash
composer require kiwilan/typescriptable-laravel
```

With **Laravel v9-10** and PHP `8.1`

```
composer require kiwilan/typescriptable-laravel:1.12.03
```

### About TypeScript

If you want to use `.d.ts` files, you need to use TypeScript in your Laravel project, you have to create a `tsconfig.json` file and add `.d.ts` paths in `compilerOptions.types`:

> [!NOTE]
>
> If you change paths into config or with options, adapt paths.

```json
{
    "compilerOptions": {
        "typeRoots": ["./node_modules/@types", "resources/**/*.d.ts"]
    },
    "include": ["resources/**/*.d.ts"]
}
```

## Configuration

You can publish the config file

```bash
php artisan vendor:publish --tag="typescriptable-config"
```

> [!IMPORTANT]
>
> You can configure `engine.models` with `artisan` or `typescriptable` to change parser engine. By default, it uses `artisan` command with [`model:show`](https://blog.laravel.com/laravel-new-model-show-command) command.
> `artisan` is default engine because it's more reliable and faster than `typescriptable` engine.

## Usage

```bash
php artisan typescriptable
```

With options:

-   --`M`|`models`: Generate Models types.
-   --`R`|`routes`: Generate Routes types.
-   --`S`|`settings`: Generate Settings types.

### Eloquent Models

Generate `resources/js/types-models.d.ts` file with all models types.

```bash
php artisan typescriptable:models
```

With options:

-   --`M`|`models-path`: Path to models directory.
-   --`O`|`output-path`: Path to output.
-   --`P`|`php-path`: Path to output PHP classes, if null will not print PHP classes.

### Spatie Settings

If you use [`spatie/laravel-settings`](https://github.com/spatie/laravel-settings), you can generate `resources/js/types-settings.d.ts` file with all settings types.

```bash
php artisan typescriptable:settings
```

With options:

-   --`S`|`settings-path`: Path to settings directory.
-   --`O`|`output-path`: Path to output.

### Routes

Generate `resources/js/types-routes.d.ts` file with all routes types and `resources/js/routes.ts` for routes references.

```bash
php artisan typescriptable:routes
```

With options:

-   --`R`|`routes-path`: Path to routes directory.
-   --`O`|`output-path`: Path to output.

## Troubleshooting

### Database prefix

You can use `prefix` variable into `config/database.php` file.

```php
'connections' => [
    'YOUR_DATABASE_CONNECTION' => [
        'prefix' => '',
    ],
],
```

Two configs works.

### Override models

`kiwilan/typescriptable-laravel` will cover many cases, but if you want to override some models, you can just create a type like `resources/js/types/index.ts` and extends `Model` type.

```ts
interface BookAdvanced extends App.Models.Book {
    pivot: {
        created_at: string;
        updated_at: string;
    };
}
```

And you can import custom type in your code when you need to use advanced type.

## Examples

Check [examples](docs/examples.md) documentation.

## Testing

Create a `.env` file with your database configuration

```bash
cp .env.example .env
```

And you can run tests

```bash
composer test
```

### Docker database

You can check <https://gist.github.com/ewilan-riviere/101cb03ee381b0adc2a22826d84e7577> gist to have a Docker database configuration.

## Changelog

Please see [CHANGELOG](CHANGELOG.md) for more information on what has changed recently.

## Credits

-   [Spatie](https://github.com/spatie): for [`spatie/package-skeleton-laravel`](https://github.com/spatie/package-skeleton-laravel)
-   [Ewilan Riviere](https://github.com/ewilan-riviere): Author package

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.

[<img src="https://user-images.githubusercontent.com/48261459/201463225-0a5a084e-df15-4b11-b1d2-40fafd3555cf.svg" height="120rem" width="100%" />](https://github.com/kiwilan)

[version-src]: https://img.shields.io/packagist/v/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[version-href]: https://packagist.org/packages/kiwilan/typescriptable-laravel
[php-version-src]: https://img.shields.io/static/v1?style=flat-square&label=PHP&message=v8.1&color=777BB4&logo=php&logoColor=ffffff&labelColor=18181b
[php-version-href]: https://www.php.net/
[npm-version-src]: https://img.shields.io/npm/v/@kiwilan/typescriptable-laravel.svg?style=flat-square&color=CB3837&logoColor=ffffff&labelColor=18181b
[npm-version-href]: https://www.npmjs.com/package/@kiwilan/typescriptable-laravel
[downloads-src]: https://img.shields.io/packagist/dt/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[downloads-href]: https://packagist.org/packages/kiwilan/typescriptable-laravel
[license-src]: https://img.shields.io/github/license/kiwilan/typescriptable-laravel.svg?style=flat-square&colorA=18181B&colorB=777BB4
[license-href]: https://github.com/kiwilan/typescriptable-laravel/blob/main/README.md
[tests-src]: https://img.shields.io/github/actions/workflow/status/kiwilan/typescriptable-laravel/run-tests.yml?branch=main&label=tests&style=flat-square&colorA=18181B
[tests-href]: https://github.com/kiwilan/typescriptable-laravel/actions/workflows/run-tests.yml
[codecov-src]: https://codecov.io/gh/kiwilan/typescriptable-laravel/branch/main/graph/badge.svg?token=P9XIK2KV9G
[codecov-href]: https://codecov.io/gh/kiwilan/typescriptable-laravel
[laravel-src]: https://img.shields.io/static/v1?label=Laravel&message=v9-11&style=flat-square&colorA=18181B&colorB=FF2D20
[laravel-href]: https://laravel.com
